{% comment %}
  Main Collection Section - Clean Shopify 2.0 Implementation
  Renders collection pages with product grid
{% endcomment %}

{{ 'collection-clean.css' | asset_url | stylesheet_tag }}

<div class="collection section-{{ section.id }}">
  <div class="page-width">
    {% for block in section.blocks %}
      {% case block.type %}
        {% when 'filters' %}
          {% if collection.filters.size > 0 and block.settings.enable_filtering %}
            <div class="collection-filters" {{ block.shopify_attributes }}>
              {% render 'collection-filters', collection: collection, block: block %}
            </div>
          {% endif %}
        
        {% when 'product-grid' %}
          <div class="collection-product-list" {{ block.shopify_attributes }}>
            {% paginate collection.products by 24 %}
              <div class="product-grid product-grid--{{ section.settings.columns_desktop }}-col-desktop">
                {% for product in collection.products %}
                  <div class="product-grid__item">
                    {% render 'product-card', 
                       product: product,
                       media_aspect_ratio: section.settings.image_ratio,
                       show_vendor: section.settings.show_vendor %}
                  </div>
                {% else %}
                  <div class="collection-empty">
                    <h2>{{ 'collections.general.no_matches' | t }}</h2>
                  </div>
                {% endfor %}
              </div>
              
              {% if paginate.pages > 1 %}
                {% render 'pagination', paginate: paginate %}
              {% endif %}
            {% endpaginate %}
          </div>
      {% endcase %}
    {% endfor %}
  </div>
</div>

{% schema %}
{
  "name": "Collection",
  "class": "section",
  "settings": [
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Number of columns on desktop"
    },
    {
      "type": "range", 
      "id": "columns_mobile",
      "min": 1,
      "max": 2,
      "step": 1,
      "default": 2,
      "label": "Number of columns on mobile"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "adapt",
      "label": "Image ratio"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show product vendor"
    }
  ],
  "blocks": [
    {
      "type": "filters",
      "name": "Filters",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "enable_filtering",
          "default": true,
          "label": "Enable filtering"
        }
      ]
    },
    {
      "type": "product-grid", 
      "name": "Product grid",
      "limit": 1
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "filters"
      },
      {
        "type": "product-grid"
      }
    ]
  }
}
{% endschema %}
