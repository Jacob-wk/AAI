{% comment %}
  Dynamic Course Categories - Based on Product Tags
  Automatically displays course categories based on actual product tags
{% endcomment %}

{{ 'collection-courses.css' | asset_url | stylesheet_tag }}

<div class="course-categories-dynamic">
  <div class="aai-container">
    {% if section.settings.title != blank %}
      <h2 class="section-title">{{ section.settings.title }}</h2>
    {% endif %}
    
    {% if section.settings.description != blank %}
      <p class="section-description">{{ section.settings.description }}</p>
    {% endif %}

    <div class="category-grid">
      {% comment %} Collect all unique tags from course products {% endcomment %}
      {% assign course_tags = '' | split: ',' %}
      {% for product in collections.courses.products %}
        {% for tag in product.tags %}
          {% unless course_tags contains tag %}
            {% assign course_tags = course_tags | append: tag | split: ',' %}
          {% endunless %}
        {% endfor %}
      {% endfor %}

      {% comment %} Display tag-based categories {% endcomment %}
      {% for tag in course_tags limit: section.settings.max_categories %}
        {% assign tag_products_count = 0 %}
        {% for product in collections.courses.products %}
          {% if product.tags contains tag %}
            {% assign tag_products_count = tag_products_count | plus: 1 %}
          {% endif %}
        {% endfor %}

        {% if tag_products_count > 0 %}
          <div class="category-card">
            <div class="category-content">
              <h3 class="category-title">{{ tag | capitalize }}</h3>
              <p class="category-count">{{ tag_products_count }} course{% if tag_products_count != 1 %}s{% endif %}</p>
              <a href="{{ routes.collections_url }}/courses?filter.p.tag={{ tag | url_encode }}" 
                 class="category-link btn btn-outline">
                View {{ tag | capitalize }} Courses
              </a>
            </div>
          </div>
        {% endif %}
      {% endfor %}
      
      {% if course_tags.size == 0 %}
        <p class="no-categories">No course categories available yet.</p>
      {% endif %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Dynamic Course Categories",
  "tag": "section",
  "class": "course-categories-dynamic",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Course Categories"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Section Description",
      "default": "Explore our courses by category to find the perfect training for your needs."
    },
    {
      "type": "range",
      "id": "max_categories",
      "label": "Maximum Categories to Show",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Dynamic Course Categories",
      "settings": {
        "title": "Course Categories",
        "description": "Explore our courses by category to find the perfect training for your needs.",
        "max_categories": 8
      }
    }
  ]
}
{% endschema %}
