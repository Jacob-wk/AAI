{% comment %}
  Help Center FAQ Section
  This section includes a script to handle search and smooth scrolling.
{% endcomment %}

{{ 'section-help-center.css' | asset_url | stylesheet_tag }}

<section id="faq-section-{{ section.id }}" class="faq-section {{ section.settings.background_style }}">
  <div class="aai-container">
    {% if section.settings.title != blank %}
      <h2 class="section-title">{{ section.settings.title }}</h2>
    {% endif %}
    <div class="faq-container">
      {% for block in section.blocks %}
        <div class="faq-item" id="{{ block.settings.category_id }}" {{ block.shopify_attributes }}>
          {% if block.settings.category_title != blank %}
            <h3 class="faq-category">{{ block.settings.category_title }}</h3>
          {% endif %}
          
          {% if block.settings.q1_question != blank %}
            <details class="faq-question">
              <summary>{{ block.settings.q1_question }}</summary>
              <div class="faq-answer">{{ block.settings.q1_answer }}</div>
            </details>
          {% endif %}
          {% if block.settings.q2_question != blank %}
            <details class="faq-question">
              <summary>{{ block.settings.q2_question }}</summary>
              <div class="faq-answer">{{ block.settings.q2_answer }}</div>
            </details>
          {% endif %}
          {% if block.settings.q3_question != blank %}
            <details class="faq-question">
              <summary>{{ block.settings.q3_question }}</summary>
              <div class="faq-answer">{{ block.settings.q3_answer }}</div>
            </details>
          {% endif %}
           {% if block.settings.q4_question != blank %}
            <details class="faq-question">
              <summary>{{ block.settings.q4_question }}</summary>
              <div class="faq-answer">{{ block.settings.q4_answer }}</div>
            </details>
          {% endif %}
           {% if block.settings.q5_question != blank %}
            <details class="faq-question">
              <summary>{{ block.settings.q5_question }}</summary>
              <div class="faq-answer">{{ block.settings.q5_answer }}</div>
            </details>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('help-search-{{ section.id }}') || document.querySelector('.help-hero .search-input'); // Fallback to general hero search if section specific not found
  const faqSection = document.getElementById('faq-section-{{ section.id }}');
  
  if (searchInput && faqSection) {
    const faqQuestions = faqSection.querySelectorAll('.faq-question');

    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase().trim();
      
      faqQuestions.forEach(question => {
        const summary = question.querySelector('summary').textContent.toLowerCase();
        const answer = question.querySelector('.faq-answer').textContent.toLowerCase();
        const faqItem = question.closest('.faq-item');
        
        if (searchTerm === '') {
          question.style.display = 'block';
          question.classList.remove('search-match');
          if(faqItem) faqItem.style.display = 'block'; // Show parent category item
        } else if (summary.includes(searchTerm) || answer.includes(searchTerm)) {
          question.style.display = 'block';
          if(faqItem) faqItem.style.display = 'block'; // Ensure parent category item is visible
          if (searchTerm.length > 2) {
            question.classList.add('search-match');
          } else {
            question.classList.remove('search-match');
          }
        } else {
          question.style.display = 'none';
          question.classList.remove('search-match');
          // Hide parent .faq-item if all its questions are hidden
          if (faqItem && faqItem.querySelectorAll('.faq-question[style*="display: block"]').length === 0) {
             // faqItem.style.display = 'none'; // This might be too aggressive, consider user experience.
          }
        }
      });
    });
  }

  // Smooth scroll for category links targeting this FAQ section
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      const targetElement = document.getElementById(href.substring(1));
      if (targetElement && faqSection.contains(targetElement)) {
        e.preventDefault();
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
        // If it's a category title, open its first question if available
        const firstQuestion = targetElement.querySelector('.faq-question details');
        if (firstQuestion && !firstQuestion.hasAttribute('open')) {
          // firstQuestion.setAttribute('open', ''); // Decided against auto-opening for now.
        }
      }
    });
  });
});
</script>

{% schema %}
{
  "name": "Help FAQ",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background Style",
      "options": [
        { "value": "section-alt-1", "label": "Alternative Background 1" },
        { "value": "section-alt-2", "label": "Alternative Background 2" },
        { "value": "section-alt-3", "label": "Alternative Background 3" },
        { "value": "section-dark", "label": "Dark Background" },
        { "value": "", "label": "Default" }
      ],
      "default": "section-alt-3"
    }
  ],
  "blocks": [
    {
      "type": "faq_category",
      "name": "FAQ Category",
      "settings": [
        {
          "type": "text",
          "id": "category_id",
          "label": "Category ID (for linking)",
          "info": "e.g., getting-started-faq. Must be unique.",
          "default": "category-faq"
        },
        {
          "type": "text",
          "id": "category_title",
          "label": "Category Title",
          "default": "FAQ Category"
        },
        {
          "type": "text",
          "id": "q1_question",
          "label": "Question 1"
        },
        {
          "type": "richtext",
          "id": "q1_answer",
          "label": "Answer 1"
        },
        {
          "type": "text",
          "id": "q2_question",
          "label": "Question 2"
        },
        {
          "type": "richtext",
          "id": "q2_answer",
          "label": "Answer 2"
        },
        {
          "type": "text",
          "id": "q3_question",
          "label": "Question 3"
        },
        {
          "type": "richtext",
          "id": "q3_answer",
          "label": "Answer 3"
        },
        {
          "type": "text",
          "id": "q4_question",
          "label": "Question 4"
        },
        {
          "type": "richtext",
          "id": "q4_answer",
          "label": "Answer 4"
        },
        {
          "type": "text",
          "id": "q5_question",
          "label": "Question 5"
        },
        {
          "type": "richtext",
          "id": "q5_answer",
          "label": "Answer 5"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Help FAQ",
      "settings": {
        "title": "Frequently Asked Questions"
      },
      "blocks": [
        {
          "type": "faq_category",
          "settings": {
            "category_id": "getting-started-faq",
            "category_title": "Getting Started",
            "q1_question": "How do I create an AAI account?",
            "q1_answer": "<p>Creating your AAI account is simple:</p><ol><li>Click \"Professional Login\" in the top right corner</li><li>Select \"Create Account\" on the login page</li><li>Fill in your professional information</li><li>Verify your email address</li><li>Complete your profile with industry details</li></ol><p>Once verified, you'll have access to browse courses and make purchases.</p>",
            "q2_question": "What information do I need for my professional profile?",
            "q2_answer": "<p>For your professional profile, please provide:</p><ul><li>Full name and contact information</li><li>Current employer and job title</li><li>Years of industry experience</li><li>State/region where you work</li><li>Industry certifications (if applicable)</li></ul><p>This information helps us recommend relevant courses and ensures your certificates display correct details.</p>",
            "q3_question": "How do I enroll in a course?",
            "q3_answer": "<p>Course enrollment is straightforward:</p><ol><li>Browse our course catalog or use the search function</li><li>Click on a course to view detailed information</li><li>Review prerequisites and course requirements</li><li>Click \"Enroll Now\" and proceed to checkout</li><li>Complete payment through our secure Stripe integration</li><li>Access your course immediately in your dashboard</li></ol>"
          }
        },
        {
          "type": "faq_category",
          "settings": {
            "category_id": "course-access-faq",
            "category_title": "Course Access",
            "q1_question": "How do I access my purchased courses?",
            "q1_answer": "<p>After purchasing a course:</p><ol><li>Log into your account</li><li>Go to \"My Dashboard\" from the account menu</li><li>Find your course in the \"Current Courses\" section</li><li>Click \"Continue Learning\" to access the embedded course player</li></ol><p>Your progress is automatically saved as you complete lessons.</p>",
            "q2_question": "What are the technical requirements?",
            "q2_answer": "<p>To ensure the best learning experience:</p><ul><li><strong>Browser:</strong> Chrome 90+, Firefox 88+, Safari 14+, Edge 90+</li><li><strong>Internet:</strong> Stable broadband connection (5+ Mbps recommended)</li><li><strong>Audio:</strong> Speakers or headphones for video content</li><li><strong>JavaScript:</strong> Must be enabled</li><li><strong>Cookies:</strong> Must be enabled for progress tracking</li></ul><p>Mobile devices are supported, but desktop/laptop recommended for optimal experience.</p>",
            "q3_question": "Can I download courses for offline viewing?",
            "q3_answer": "<p>Currently, our courses are designed for online access only to ensure:</p><ul><li>Real-time progress tracking and reporting</li><li>Up-to-date content and safety regulations</li><li>Interactive elements and assessments</li><li>Secure access and content protection</li></ul><p>However, downloadable resources like PDFs and reference materials are available for each course.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
