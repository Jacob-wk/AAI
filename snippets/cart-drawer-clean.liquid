{% comment %}
  Clean cart drawer implementation
{% endcomment %}

<cart-drawer-component class="cart-drawer">
  <dialog class="cart-drawer__dialog dialog" data-ref="dialog">
    <div class="cart-drawer__backdrop backdrop" data-ref="backdrop"></div>
    
    <div class="cart-drawer__content">
      <div class="cart-drawer__header">
        <h2 class="cart-drawer__title">
          {{ 'sections.cart.title' | t }}
          <span class="cart-drawer__count">({{ cart.item_count }})</span>
        </h2>
        
        <button class="cart-drawer__close" on:click="/close" aria-label="{{ 'accessibility.close' | t }}">
          {{ 'icon-close.svg' | inline_asset_content }}
        </button>
      </div>

      {% if cart == empty %}
        <div class="cart-drawer__empty">
          <div class="cart-drawer__empty-icon">
            {{ 'icon-cart.svg' | inline_asset_content }}
          </div>
          <h3>{{ 'sections.cart.empty' | t }}</h3>
          <a href="{{ routes.all_products_collection_url }}" class="button button--primary">
            {{ 'general.continue_shopping' | t }}
          </a>
        </div>
      {% else %}
        <div class="cart-drawer__items">
          <form action="{{ routes.cart_url }}" method="post" id="cart-drawer-form">
            <div class="cart-items">
              {%- for item in cart.items -%}
                <div class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
                  {% if item.image %}
                    <div class="cart-item__media">
                      <img
                        src="{{ item.image | image_url: width: 300 }}"
                        alt="{{ item.image.alt | escape }}"
                        loading="lazy"
                        width="150"
                        height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                      >
                    </div>
                  {% endif %}

                  <div class="cart-item__details">
                    <h3 class="cart-item__name">
                      <a href="{{ item.url }}">{{ item.product.title | escape }}</a>
                    </h3>

                    <div class="cart-item__price">
                      {%- if item.original_price != item.final_price -%}
                        <s class="cart-item__old-price">{{ item.original_price | money }}</s>
                        <span class="cart-item__final-price">{{ item.final_price | money }}</span>
                      {%- else -%}
                        <span>{{ item.original_price | money }}</span>
                      {%- endif -%}
                    </div>

                    {%- if item.product.has_only_default_variant == false -%}
                      <div class="cart-item__options">
                        {%- for option in item.options_with_values -%}
                          <div class="cart-item__option">
                            <span>{{ option.name }}: {{ option.value }}</span>
                          </div>
                        {%- endfor -%}
                      </div>
                    {%- endif -%}

                    <div class="cart-item__quantity">
                      <label for="quantity-{{ item.index | plus: 1 }}">{{ 'products.product.quantity.label' | t }}</label>
                      <quantity-input class="quantity">
                        <button class="quantity__button" name="minus" type="button">-</button>
                        <input
                          class="quantity__input"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          min="0"
                          id="quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                        >
                        <button class="quantity__button" name="plus" type="button">+</button>
                      </quantity-input>
                      
                      <cart-remove-button data-index="{{ item.index | plus: 1 }}">
                        <button type="button" class="cart-item__remove">
                          {{ 'sections.cart.remove' | t }}
                        </button>
                      </cart-remove-button>
                    </div>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </form>
        </div>

        <div class="cart-drawer__footer">
          <div class="cart-drawer__subtotal">
            <span>{{ 'sections.cart.subtotal' | t }}: {{ cart.total_price | money }}</span>
          </div>
          
          <div class="cart-drawer__actions">
            <a href="{{ routes.cart_url }}" class="button button--secondary">
              {{ 'sections.cart.view_cart' | t }}
            </a>
            <button type="submit" form="cart-drawer-form" formaction="/checkout" class="button button--primary">
              {{ 'sections.cart.checkout' | t }}
            </button>
          </div>
        </div>
      {% endif %}
    </div>
  </dialog>

  <button class="cart-drawer__trigger" on:click="/open" aria-label="{{ 'accessibility.cart' | t }}">
    {% render 'cart-icon-component' %}
  </button>
</cart-drawer-component>
