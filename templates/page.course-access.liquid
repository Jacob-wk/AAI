{% comment %}
  Course Access Template - Embedded Intuto Course Player
  Used for displaying purchased courses with embedded Intuto content
  
  URL structure: /pages/course-access-[course-id]
  Metafields: page.metafields.intuto.course_id, page.metafields.intuto.embed_url
{% endcomment %}

<article class="course-access-page">
  <div class="course-player-container section-alt-1">
    <div class="course-header">
      <div class="aai-container">
        <nav class="breadcrumb" aria-label="Course navigation">
          <a href="{{ routes.root_url }}" class="breadcrumb__link">Home</a>
          <span class="breadcrumb__separator">›</span>
          <a href="/pages/my-courses" class="breadcrumb__link">My Courses</a>
          <span class="breadcrumb__separator">›</span>
          <span class="breadcrumb__current">{{ page.title }}</span>
        </nav>
        
        <div class="course-meta">
          <h1 class="course-title">{{ page.title }}</h1>
          {% if page.metafields.course.ceu_credits %}
            <div class="course-badges">
              <span class="badge badge--ceu">{{ page.metafields.course.ceu_credits }} CEU Credits</span>
              {% if page.metafields.course.certification %}
                <span class="badge badge--cert">{{ page.metafields.course.certification }}</span>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="course-content section-alt-2">
      <div class="aai-container">
        {% comment %} Embedded Intuto Course Player {% endcomment %}
        <div class="intuto-player-wrapper">
          {% render 'intuto-player', 
            course_id: page.metafields.intuto.course_id,
            embed_url: page.metafields.intuto.embed_url,
            customer: customer,
            course_title: page.title %}
        </div>
        
        {% comment %} Course sidebar with progress and resources {% endcomment %}
        <aside class="course-sidebar">
            <div class="progress-card">
              <h3>Your Progress</h3>
              <div class="progress-bar">
                <div class="progress-fill" style="width: {{ customer.metafields.intuto.progress | default: 0 }}%"></div>
              </div>
              <p class="progress-text">{{ customer.metafields.intuto.progress | default: 0 }}% Complete</p>
            </div>
            
            {% if page.metafields.course.resources %}
              <div class="resources-card">
                <h3>Course Resources</h3>
                <ul class="resources-list">
                  {% assign resources = page.metafields.course.resources | split: ',' %}
                  {% for resource in resources %}
                    <li><a href="{{ resource | strip }}" target="_blank" rel="noopener">{{ resource | strip | split: '/' | last }}</a></li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
            
            <div class="support-card">
              <h3>Need Help?</h3>
              <p>Contact our support team for technical assistance.</p>
              <a href="/pages/contact" class="btn btn--secondary">Get Support</a>
            </div>
          </aside>
          
        {% else %}
          {% comment %} Show message handled by intuto-player snippet {% endcomment %}
          <div class="access-message">
            <p>Please ensure you have access to this course content.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</article>

<!-- CSS extracted to /assets/course-access-page.css -->

<script>
document.addEventListener('DOMContentLoaded', function() {
  const iframe = document.getElementById('intuto-course-player');
  const loading = document.getElementById('course-loading');
  
  if (iframe && loading) {
    iframe.addEventListener('load', function() {
      loading.style.display = 'none';
    });
    
    // Hide loading after 10 seconds as fallback
    setTimeout(function() {
      if (loading) {
        loading.style.display = 'none';
      }
    }, 10000);
  }
});
</script>
