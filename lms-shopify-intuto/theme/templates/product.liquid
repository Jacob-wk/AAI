{% comment %}
COPILOT CONTEXT:
- Product template for course pages with professional education focus
- Matches AAI authority aesthetic with enrollment functionality
- Professional learning platform design (not casual e-commerce)
{% endcomment %}

<div class="aai-course-page" data-product-id="{{ product.id }}">
  <div class="aai-container">
    <div class="aai-course-layout">
      <!-- Course Information -->
      <div class="aai-course-main">
        <div class="aai-course-header">
          <h1>{{ product.title }}</h1>
          <div class="aai-course-meta">
            <span class="aai-meta-item">
              <strong>Duration:</strong> {{ product.metafields.aai.duration | default: '6 hours' }}
            </span>
            <span class="aai-meta-item">
              <strong>Level:</strong> {{ product.metafields.aai.level | default: 'Intermediate' }}
            </span>
            <span class="aai-meta-item">
              <strong>Certification:</strong> {{ product.metafields.aai.certification | default: 'AAI Certified' }}
            </span>
          </div>
        </div>

        <!-- Course Description -->
        <div class="aai-course-description">
          <h2>Course Overview</h2>
          <div class="aai-description-content">
            {{ product.description }}
          </div>
        </div>

        <!-- Course Curriculum -->
        {% if product.metafields.aai.curriculum %}
          <div class="aai-course-curriculum">
            <h2>What You'll Learn</h2>
            <div class="aai-curriculum-content">
              {{ product.metafields.aai.curriculum }}
            </div>
          </div>
        {% endif %}

        <!-- Learning Objectives -->
        {% if product.metafields.aai.objectives %}
          <div class="aai-course-objectives">
            <h2>Learning Objectives</h2>
            <ul class="aai-objectives-list">
              {% assign objectives = product.metafields.aai.objectives | split: '|' %}
              {% for objective in objectives %}
                <li>{{ objective | strip }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>

      <!-- Course Sidebar -->
      <div class="aai-course-sidebar">
        <!-- Course Card -->
        <div class="aai-course-enrollment-card">
          {% if product.featured_image %}
            <div class="aai-course-image">
              <img src="{{ product.featured_image | img_url: '400x300' }}" 
                   alt="{{ product.title }}" 
                   loading="lazy">
            </div>
          {% endif %}

          <div class="aai-course-pricing">
            <div class="aai-price-display">
              <span class="aai-price">${{ product.price | money_without_currency }}</span>
              {% if product.compare_at_price > product.price %}
                <span class="aai-compare-price">${{ product.compare_at_price | money_without_currency }}</span>
              {% endif %}
            </div>
          </div>

          <!-- Enrollment Section -->
          <div class="aai-enrollment-section">
            {% if customer %}
              <!-- Check if customer already purchased this course -->
              {% assign has_access = false %}
              {% for order in customer.orders %}
                {% for line_item in order.line_items %}
                  {% if line_item.product_id == product.id %}
                    {% assign has_access = true %}
                    {% break %}
                  {% endif %}
                {% endfor %}
              {% endfor %}

              {% if has_access %}
                <!-- Already enrolled - show access button -->
                <button class="aai-btn aai-btn-primary aai-btn-full aai-btn-continue" 
                        data-product-id="{{ product.id }}">
                  Continue Learning
                </button>
                {% render 'progress-tracker', product_id: product.id %}
              {% else %}
                <!-- Not enrolled - show enrollment button -->
                <form action="/cart/add" method="post" enctype="multipart/form-data">
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                  <button type="submit" class="aai-btn aai-btn-primary aai-btn-full enroll-btn"
                          data-product-id="{{ product.id }}">
                    Enroll Now - ${{ product.price | money_without_currency }}
                  </button>
                </form>
              {% endif %}
            {% else %}
              <!-- Guest user - prompt to login/register -->
              <a href="/account/login?return_url={{ request.path }}" 
                 class="aai-btn aai-btn-primary aai-btn-full">
                Login to Enroll
              </a>
              <p class="aai-login-note">
                New to AAI? <a href="/account/register">Create an account</a> to start learning.
              </p>
            {% endif %}
          </div>

          <!-- Course Features -->
          <div class="aai-course-features">
            <h3>What's Included</h3>
            <ul class="aai-features-list">
              <li>
                <span class="aai-feature-icon">üìö</span>
                Comprehensive course materials
              </li>
              <li>
                <span class="aai-feature-icon">üéì</span>
                Industry-recognized certification
              </li>
              <li>
                <span class="aai-feature-icon">‚è∞</span>
                Self-paced learning
              </li>
              <li>
                <span class="aai-feature-icon">üì±</span>
                Mobile-friendly access
              </li>
              <li>
                <span class="aai-feature-icon">üîÑ</span>
                Lifetime access to updates
              </li>
              <li>
                <span class="aai-feature-icon">üí¨</span>
                Expert instructor support
              </li>
            </ul>
          </div>
        </div>

        <!-- Prerequisites -->
        {% if product.metafields.aai.prerequisites %}
          <div class="aai-course-prerequisites">
            <h3>Prerequisites</h3>
            <div class="aai-prerequisites-content">
              {{ product.metafields.aai.prerequisites }}
            </div>
          </div>
        {% endif %}

        <!-- Related Courses -->
        {% assign related_products = collections[product.metafields.aai.related_collection].products | default: collections.all.products %}
        {% if related_products.size > 1 %}
          <div class="aai-related-courses">
            <h3>Related Courses</h3>
            <div class="aai-related-grid">
              {% for related_product in related_products limit: 3 %}
                {% unless related_product.id == product.id %}
                  <div class="aai-related-course">
                    <a href="{{ related_product.url }}">
                      {% if related_product.featured_image %}
                        <img src="{{ related_product.featured_image | img_url: '200x150' }}" 
                             alt="{{ related_product.title }}" 
                             loading="lazy">
                      {% endif %}
                      <h4>{{ related_product.title }}</h4>
                      <span class="aai-related-price">${{ related_product.price | money_without_currency }}</span>
                    </a>
                  </div>
                {% endunless %}
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  /* Course Page Styles */
  .aai-course-page {
    padding: 40px 0 80px;
    min-height: 100vh;
  }

  .aai-course-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 60px;
    align-items: start;
  }

  .aai-course-header h1 {
    font-size: 2.5rem;
    color: var(--authority-navy);
    margin-bottom: 20px;
    line-height: 1.2;
  }

  .aai-course-meta {
    display: flex;
    gap: 30px;
    margin-bottom: 40px;
    flex-wrap: wrap;
  }

  .aai-meta-item {
    font-size: 0.9rem;
    color: #6c757d;
  }

  .aai-meta-item strong {
    color: var(--authority-navy);
  }

  .aai-course-description h2,
  .aai-course-curriculum h2,
  .aai-course-objectives h2 {
    font-size: 1.5rem;
    color: var(--authority-navy);
    margin-bottom: 20px;
    margin-top: 40px;
  }

  .aai-description-content,
  .aai-curriculum-content {
    line-height: 1.7;
    color: #495057;
  }

  .aai-objectives-list {
    list-style: none;
    padding: 0;
  }

  .aai-objectives-list li {
    padding: 12px 0;
    border-bottom: 1px solid #e9ecef;
    position: relative;
    padding-left: 25px;
  }

  .aai-objectives-list li:before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: var(--electric-blue);
    font-weight: bold;
  }

  /* Sidebar Styles */
  .aai-course-enrollment-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    overflow: hidden;
    margin-bottom: 30px;
  }

  .aai-course-image img {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .aai-course-pricing {
    padding: 25px;
    text-align: center;
    border-bottom: 1px solid #e9ecef;
  }

  .aai-price-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
  }

  .aai-price {
    font-size: 2rem;
    font-weight: 700;
    color: var(--authority-navy);
  }

  .aai-compare-price {
    font-size: 1.25rem;
    color: #6c757d;
    text-decoration: line-through;
  }

  .aai-enrollment-section {
    padding: 25px;
  }

  .aai-btn-full {
    width: 100%;
    justify-content: center;
    margin-bottom: 15px;
  }

  .aai-login-note {
    text-align: center;
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 15px;
  }

  .aai-login-note a {
    color: var(--electric-blue);
    text-decoration: none;
  }

  .aai-login-note a:hover {
    text-decoration: underline;
  }

  .aai-course-features {
    padding: 25px;
    border-top: 1px solid #e9ecef;
  }

  .aai-course-features h3 {
    font-size: 1.125rem;
    color: var(--authority-navy);
    margin-bottom: 20px;
  }

  .aai-features-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .aai-features-list li {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 0;
    font-size: 0.9rem;
    color: #495057;
  }

  .aai-feature-icon {
    font-size: 1.1rem;
  }

  .aai-course-prerequisites,
  .aai-related-courses {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 25px;
    margin-bottom: 30px;
  }

  .aai-course-prerequisites h3,
  .aai-related-courses h3 {
    font-size: 1.125rem;
    color: var(--authority-navy);
    margin-bottom: 15px;
  }

  .aai-prerequisites-content {
    font-size: 0.9rem;
    line-height: 1.6;
    color: #495057;
  }

  .aai-related-grid {
    display: grid;
    gap: 15px;
  }

  .aai-related-course a {
    display: block;
    text-decoration: none;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.3s ease;
  }

  .aai-related-course a:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
  }

  .aai-related-course img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    border-radius: 4px;
    margin-bottom: 10px;
  }

  .aai-related-course h4 {
    font-size: 0.9rem;
    color: var(--authority-navy);
    margin-bottom: 8px;
    line-height: 1.3;
  }

  .aai-related-price {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--electric-blue);
  }

  /* Mobile responsiveness */
  @media (max-width: 968px) {
    .aai-course-layout {
      grid-template-columns: 1fr;
      gap: 40px;
    }
    
    .aai-course-header h1 {
      font-size: 2rem;
    }
    
    .aai-course-meta {
      flex-direction: column;
      gap: 10px;
    }
  }
</style>
